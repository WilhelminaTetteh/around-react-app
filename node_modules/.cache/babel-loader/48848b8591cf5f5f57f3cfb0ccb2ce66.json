{"ast":null,"code":"import _toConsumableArray from\"/Users/wilhelminatetteh/Desktop/around-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/wilhelminatetteh/Desktop/around-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import Header from\"./Header\";import Footer from\"./Footer\";import Main from\"./Main\";import PopupWithForm from\"./PopupWithForm\";import ImagePopup from\"./ImagePopup\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup\";import api from\"../utils/api\";import{CurrentUserContext}from\"../contexts/CurrentUserContext.js\";import{Route,Switch,Redirect,useHistory}from\"react-router-dom\";import Login from\"./Login\";import Register from\"./Register\";import ProtectedRoute from\"./ProtectedRoute.js\";import InfoToolTip from\"./InfoTooltip\";import*as auth from\"../utils/auth\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){// State variable and setters\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),isEditProfilePopupOpen=_useState2[0],setIsEditProfilePopupOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isAddPlacePopupOpen=_useState4[0],setIsAddPlacePopupOpen=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isEditAvatarPopupOpen=_useState6[0],setIsEditAvatarPopupOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isImagePopupOpen=_useState8[0],setIsImagePopupOpen=_useState8[1];// NOTE : info tooltip original state\nvar _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isInfoToolTipPopupOpen=_useState10[0],setIsInfoToolTipPopupOpen=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),selectedCard=_useState12[0],setSelectedCard=_useState12[1];var _useState13=useState({}),_useState14=_slicedToArray(_useState13,2),currentUser=_useState14[0],setCurrentUser=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),cards=_useState16[0],setCards=_useState16[1];//loggedin state\nvar _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),loggedIn=_React$useState2[0],setLoggedIn=_React$useState2[1];// use userData to show user email on the nav\n// const [userData, setUserData] = useState({});\nvar _useState17=useState(\"\"),_useState18=_slicedToArray(_useState17,2),password=_useState18[0],setPassword=_useState18[1];var _useState19=useState(\"\"),_useState20=_slicedToArray(_useState19,2),email=_useState20[0],setEmail=_useState20[1];var _useState21=useState(\"\"),_useState22=_slicedToArray(_useState21,2),message=_useState22[0],setMessage=_useState22[1];var history=useHistory();var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isSuccessful=_React$useState4[0],setIsSuccessful=_React$useState4[1];//HANDLE AUTHENTICATIONe\nuseEffect(function(){tokenCheck();},[]);useEffect(function(){api.getInfo().then(function(res){setCurrentUser(res);}).catch(function(err){console.log(err);});},[]);useEffect(function(){api.getCardList().then(function(res){setCards(res);}).catch(function(err){console.log(err);});},[]);//handlers for opening modals\nfunction handleEditAvatarClick(){// console.log(\"The Avatar was clicked.\");\nsetIsEditAvatarPopupOpen(true);}function handleEditProfileClick(){// console.log(\"The Profile was clicked.\");\nsetIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){// console.log(\"The Place button  was clicked.\");\nsetIsAddPlacePopupOpen(true);}//Image Popup\nfunction handleCardClick(_ref){var name=_ref.name,link=_ref.link;setSelectedCard({name:name,link:link});setIsImagePopupOpen(true);}// NOTE :Handle info tooltip\nfunction handleInfoTooltip(){setIsInfoToolTipPopupOpen(true);}//close modals\nfunction closeAllPopups(){// console.log(\"Popup was closed\");\nsetIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setIsEditAvatarPopupOpen(false);setIsImagePopupOpen(false);// NOTE Close Info Tool Tip\nsetIsInfoToolTipPopupOpen(false);setSelectedCard({});}//ESC Close\nuseEffect(function(){var closeByEscape=function closeByEscape(e){if(e.key===\"Escape\"){closeAllPopups();}};document.addEventListener(\"keydown\",closeByEscape);return function(){return document.removeEventListener(\"keydown\",closeByEscape);};},[]);//Handle User Update\nfunction handleUpdateUser(_ref2){var name=_ref2.name,about=_ref2.about;api.updateUserInfo({name:name,about:about}).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(err){console.log(err);});}//Handle avatar update\nfunction handleUpdateAvatar(_ref3){var avatar=_ref3.avatar;api.setUserAvatar({avatar:avatar}).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(err){console.log(err);});}function handleCardLike(card){// Check one more time if this card was already liked\nvar isLiked=card.likes.some(function(i){return i._id===currentUser._id;});// Send a request to the API and getting the updated card data\nif(!isLiked){api.changeLikeCardStatus(card._id).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}else{api.deleteLike(card._id).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(err){console.log(err);});}}function handleCardDelete(card){// After the API request, update the cards state using the filter() method. Create a copy\n// of the array and exclude the deleted card from it.\napi.removeCard(card._id).then(function(){var cardList=cards.filter(function(c){return c._id!==card._id;});setCards(cardList);}).catch(function(err){console.log(err);});}function handleAddPlaceSubmit(_ref4){var name=_ref4.name,link=_ref4.link;api.addCard({name:name,link:link}).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){console.log(err);});}// REGISTRATION\nvar handleRegistration=function handleRegistration(email,password){auth.register(email,password)// We only want to redirect users after the registration form has been properly submitted\n.then(function(res){if(email&&password){setIsSuccessful(true);setIsInfoToolTipPopupOpen(true);history.push(\"/signin\");// console.log(\"res good\");\nreturn res;}else{setIsSuccessful(false);}}).catch(function(err){setIsInfoToolTipPopupOpen(true);console.log(err);// console.log(\"res bad\");\nreturn setMessage(\"400 - one of the fields was filled in incorrectly\");});};// const handleRegistration = (email, password) => {\n//   if (email && password) {\n//     auth\n//       .register(email, password)\n//       // We only want to redirect users after the registration form has been properly submitted\n//       .then((res) => {\n//         setIsSuccessful(true);\n//         setIsInfoToolTipPopupOpen(true);\n//         history.push(\"/signin\");\n//         console.log(\"res good\");\n//         return res;\n//       })\n//       .catch((err) => {\n//         setIsSuccessful(false);\n//         setIsInfoToolTipPopupOpen(true);\n//         console.log(err);\n//       });\n//   } else {\n//     // console.log(\"res bad\");\n//     return setMessage(\n//       \"400 - one of the fields was filled in incorrectly\"\n//     );\n//   }\n// };\n//LOG IN\nvar handleLogin=function handleLogin(email,password){auth.authorize(email,password).then(function(data){if(!data){return setMessage(\"one or more of the fields were not provided\");}if(data){// set\nsetEmail(email);// TODO  handle login\nsetLoggedIn(true);// redirect user to cards\nhistory.push(\"/\");return;}}).catch(function(err){console.log(err);setMessage(err.message);});};//LOGOUT\nfunction handleLogOut(){localStorage.removeItem(\"jwt\");setLoggedIn(false);setEmail(\"\");setPassword(\"\");}var tokenCheck=function tokenCheck(){// if user has a token in storage, check if it is valid\nif(localStorage.getItem(\"jwt\")){var jwt=localStorage.getItem(\"jwt\");// make the request\nauth.getContent(jwt).then(function(res){// if response is successful, log in the user\nif(res){setEmail(res.data.email);setLoggedIn(true);// also push user to the Home Page\nhistory.push(\"/\");// NOTE  : set user data in header. use This method for more than one userData\n// const userData = {\n//   email: res.email,\n// };\n// setUserData(userData);\n}console.log(\"something went wrong- tokencheck\");}).catch(function(err){return console.log(err);});}};return/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsx(\"div\",{className:\"page__container\",children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header// userData={userData}\n,{email:email,loggedIn:loggedIn,handleLogOut:handleLogOut}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{component:Main,exact:true,path:\"/\",loggedIn:loggedIn,onEditAvatarClick:handleEditAvatarClick,onEditProfileClick:handleEditProfileClick,onAddPlaceClick:handleAddPlaceClick,onCardClick:handleCardClick,cards:cards,onCardLike:handleCardLike,onCardDelete:handleCardDelete,email:email}),/*#__PURE__*/_jsx(Route,{path:\"/signup\",children:/*#__PURE__*/_jsx(Register,{handleRegistration:handleRegistration})}),/*#__PURE__*/_jsx(Route,{path:\"/signin\",children:/*#__PURE__*/_jsx(Login,{handleLogin:handleLogin,tokenCheck:tokenCheck})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/signin\"})})]}),loggedIn&&/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(PopupWithForm,{name:\"delete\",title:\"Are you sure?\",buttonText:\"Yes\"}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups,isOpen:isImagePopupOpen}),/*#__PURE__*/_jsx(InfoToolTip,{isOpen:isInfoToolTipPopupOpen,onClose:closeAllPopups,onShowToolTip:handleInfoTooltip,isvalidRegistration:isSuccessful})]})})});}export default App;","map":{"version":3,"sources":["/Users/wilhelminatetteh/Desktop/around-react-app/src/components/App.js"],"names":["React","useEffect","useState","Header","Footer","Main","PopupWithForm","ImagePopup","EditProfilePopup","EditAvatarPopup","AddPlacePopup","api","CurrentUserContext","Route","Switch","Redirect","useHistory","Login","Register","ProtectedRoute","InfoToolTip","auth","App","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isImagePopupOpen","setIsImagePopupOpen","isInfoToolTipPopupOpen","setIsInfoToolTipPopupOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","loggedIn","setLoggedIn","password","setPassword","email","setEmail","message","setMessage","history","isSuccessful","setIsSuccessful","tokenCheck","getInfo","then","res","catch","err","console","log","getCardList","handleEditAvatarClick","handleEditProfileClick","handleAddPlaceClick","handleCardClick","name","link","handleInfoTooltip","closeAllPopups","closeByEscape","e","key","document","addEventListener","removeEventListener","handleUpdateUser","about","updateUserInfo","handleUpdateAvatar","avatar","setUserAvatar","handleCardLike","card","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","state","map","c","deleteLike","handleCardDelete","removeCard","cardList","filter","handleAddPlaceSubmit","addCard","handleRegistration","register","push","handleLogin","authorize","data","handleLogOut","localStorage","removeItem","getItem","jwt","getContent"],"mappings":"8QAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,IAAP,KAAiB,QAAjB,CACA,MAAOC,CAAAA,aAAP,KAA0B,iBAA1B,CACA,MAAOC,CAAAA,UAAP,KAAuB,cAAvB,CACA,MAAOC,CAAAA,gBAAP,KAA6B,oBAA7B,CACA,MAAOC,CAAAA,eAAP,KAA4B,mBAA5B,CACA,MAAOC,CAAAA,aAAP,KAA0B,iBAA1B,CACA,MAAOC,CAAAA,GAAP,KAAgB,cAAhB,CACA,OAASC,kBAAT,KAAmC,mCAAnC,CACA,OACEC,KADF,CAEEC,MAFF,CAGEC,QAHF,CAIEC,UAJF,KAKO,kBALP,CAMA,MAAOC,CAAAA,KAAP,KAAkB,SAAlB,CACA,MAAOC,CAAAA,QAAP,KAAqB,YAArB,CACA,MAAOC,CAAAA,cAAP,KAA2B,qBAA3B,CACA,MAAOC,CAAAA,WAAP,KAAwB,eAAxB,CACA,MAAO,GAAKC,CAAAA,IAAZ,KAAsB,eAAtB,C,wFAEA,QAASC,CAAAA,GAAT,EAAe,CACb;AACA,cACEpB,QAAQ,CAAC,KAAD,CADV,wCAAOqB,sBAAP,eAA+BC,yBAA/B,eAEA,eACEtB,QAAQ,CAAC,KAAD,CADV,yCAAOuB,mBAAP,eAA4BC,sBAA5B,eAEA,eACExB,QAAQ,CAAC,KAAD,CADV,yCAAOyB,qBAAP,eAA8BC,wBAA9B,eAEA,eAAgD1B,QAAQ,CAAC,KAAD,CAAxD,yCAAO2B,gBAAP,eAAyBC,mBAAzB,eACA;AACA,eACE5B,QAAQ,CAAC,KAAD,CADV,0CAAO6B,sBAAP,gBAA+BC,yBAA/B,gBAEA,gBAAwC9B,QAAQ,CAAC,EAAD,CAAhD,2CAAO+B,YAAP,gBAAqBC,eAArB,gBACA,gBAAsChC,QAAQ,CAAC,EAAD,CAA9C,2CAAOiC,WAAP,gBAAoBC,cAApB,gBACA,gBAA0BlC,QAAQ,CAAC,EAAD,CAAlC,2CAAOmC,KAAP,gBAAcC,QAAd,gBACA;AACA,oBAAgCtC,KAAK,CAACE,QAAN,CAAe,KAAf,CAAhC,oDAAOqC,QAAP,qBAAiBC,WAAjB,qBACA;AACA;AACA,gBAAgCtC,QAAQ,CAAC,EAAD,CAAxC,2CAAOuC,QAAP,gBAAiBC,WAAjB,gBACA,gBAA0BxC,QAAQ,CAAC,EAAD,CAAlC,2CAAOyC,KAAP,gBAAcC,QAAd,gBACA,gBAA8B1C,QAAQ,CAAC,EAAD,CAAtC,2CAAO2C,OAAP,gBAAgBC,UAAhB,gBAEA,GAAMC,CAAAA,OAAO,CAAG/B,UAAU,EAA1B,CACA,qBAAwChB,KAAK,CAACE,QAAN,CAAe,KAAf,CAAxC,qDAAO8C,YAAP,qBAAqBC,eAArB,qBAEA;AAEAhD,SAAS,CAAC,UAAM,CACdiD,UAAU,GACX,CAFQ,CAEN,EAFM,CAAT,CAIAjD,SAAS,CAAC,UAAM,CACdU,GAAG,CACAwC,OADH,GAEGC,IAFH,CAEQ,SAACC,GAAD,CAAS,CACbjB,cAAc,CAACiB,GAAD,CAAd,CACD,CAJH,EAKGC,KALH,CAKS,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CAPH,EAQD,CATQ,CASN,EATM,CAAT,CAUAtD,SAAS,CAAC,UAAM,CACdU,GAAG,CACA+C,WADH,GAEGN,IAFH,CAEQ,SAACC,GAAD,CAAS,CACbf,QAAQ,CAACe,GAAD,CAAR,CACD,CAJH,EAKGC,KALH,CAKS,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CAPH,EAQD,CATQ,CASN,EATM,CAAT,CAWA;AACA,QAASI,CAAAA,qBAAT,EAAiC,CAC/B;AACA/B,wBAAwB,CAAC,IAAD,CAAxB,CACD,CACD,QAASgC,CAAAA,sBAAT,EAAkC,CAChC;AACApC,yBAAyB,CAAC,IAAD,CAAzB,CACD,CACD,QAASqC,CAAAA,mBAAT,EAA+B,CAC7B;AACAnC,sBAAsB,CAAC,IAAD,CAAtB,CACD,CACD;AACA,QAASoC,CAAAA,eAAT,MAAyC,IAAdC,CAAAA,IAAc,MAAdA,IAAc,CAARC,IAAQ,MAARA,IAAQ,CACvC9B,eAAe,CAAC,CAAE6B,IAAI,CAAJA,IAAF,CAAQC,IAAI,CAAJA,IAAR,CAAD,CAAf,CACAlC,mBAAmB,CAAC,IAAD,CAAnB,CACD,CACD;AACA,QAASmC,CAAAA,iBAAT,EAA6B,CAC3BjC,yBAAyB,CAAC,IAAD,CAAzB,CACD,CACD;AACA,QAASkC,CAAAA,cAAT,EAA0B,CACxB;AACA1C,yBAAyB,CAAC,KAAD,CAAzB,CACAE,sBAAsB,CAAC,KAAD,CAAtB,CACAE,wBAAwB,CAAC,KAAD,CAAxB,CACAE,mBAAmB,CAAC,KAAD,CAAnB,CACA;AACAE,yBAAyB,CAAC,KAAD,CAAzB,CACAE,eAAe,CAAC,EAAD,CAAf,CACD,CACD;AACAjC,SAAS,CAAC,UAAM,CACd,GAAMkE,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,CAAD,CAAO,CAC3B,GAAIA,CAAC,CAACC,GAAF,GAAU,QAAd,CAAwB,CACtBH,cAAc,GACf,CACF,CAJD,CAKAI,QAAQ,CAACC,gBAAT,CAA0B,SAA1B,CAAqCJ,aAArC,EACA,MAAO,kBACLG,CAAAA,QAAQ,CAACE,mBAAT,CAA6B,SAA7B,CAAwCL,aAAxC,CADK,EAAP,CAED,CATQ,CASN,EATM,CAAT,CAWA;AACA,QAASM,CAAAA,gBAAT,OAA2C,IAAfV,CAAAA,IAAe,OAAfA,IAAe,CAATW,KAAS,OAATA,KAAS,CACzC/D,GAAG,CACAgE,cADH,CACkB,CAAEZ,IAAI,CAAJA,IAAF,CAAQW,KAAK,CAALA,KAAR,CADlB,EAEGtB,IAFH,CAEQ,SAACC,GAAD,CAAS,CACbjB,cAAc,CAACiB,GAAD,CAAd,CACAa,cAAc,GACf,CALH,EAMGZ,KANH,CAMS,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CARH,EASD,CAED;AACA,QAASqB,CAAAA,kBAAT,OAAwC,IAAVC,CAAAA,MAAU,OAAVA,MAAU,CACtClE,GAAG,CACAmE,aADH,CACiB,CAAED,MAAM,CAANA,MAAF,CADjB,EAEGzB,IAFH,CAEQ,SAACC,GAAD,CAAS,CACbjB,cAAc,CAACiB,GAAD,CAAd,CACAa,cAAc,GACf,CALH,EAMGZ,KANH,CAMS,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CARH,EASD,CACD,QAASwB,CAAAA,cAAT,CAAwBC,IAAxB,CAA8B,CAC5B;AACA,GAAMC,CAAAA,OAAO,CAAGD,IAAI,CAACE,KAAL,CAAWC,IAAX,CAAgB,SAACC,CAAD,QAAOA,CAAAA,CAAC,CAACC,GAAF,GAAUlD,WAAW,CAACkD,GAA7B,EAAhB,CAAhB,CAEA;AACA,GAAI,CAACJ,OAAL,CAAc,CACZtE,GAAG,CACA2E,oBADH,CACwBN,IAAI,CAACK,GAD7B,EAEGjC,IAFH,CAEQ,SAACmC,OAAD,CAAa,CACjBjD,QAAQ,CAAC,SAACkD,KAAD,QACPA,CAAAA,KAAK,CAACC,GAAN,CAAU,SAACC,CAAD,QAAQA,CAAAA,CAAC,CAACL,GAAF,GAAUL,IAAI,CAACK,GAAf,CAAqBE,OAArB,CAA+BG,CAAvC,EAAV,CADO,EAAD,CAAR,CAGD,CANH,EAOGpC,KAPH,CAOS,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CATH,EAUD,CAXD,IAWO,CACL5C,GAAG,CACAgF,UADH,CACcX,IAAI,CAACK,GADnB,EAEGjC,IAFH,CAEQ,SAACmC,OAAD,CAAa,CACjBjD,QAAQ,CAAC,SAACkD,KAAD,QACPA,CAAAA,KAAK,CAACC,GAAN,CAAU,SAACC,CAAD,QAAQA,CAAAA,CAAC,CAACL,GAAF,GAAUL,IAAI,CAACK,GAAf,CAAqBE,OAArB,CAA+BG,CAAvC,EAAV,CADO,EAAD,CAAR,CAGD,CANH,EAOGpC,KAPH,CAOS,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CATH,EAUD,CACF,CACD,QAASqC,CAAAA,gBAAT,CAA0BZ,IAA1B,CAAgC,CAC9B;AACA;AACArE,GAAG,CACAkF,UADH,CACcb,IAAI,CAACK,GADnB,EAEGjC,IAFH,CAEQ,UAAM,CACV,GAAM0C,CAAAA,QAAQ,CAAGzD,KAAK,CAAC0D,MAAN,CAAa,SAACL,CAAD,QAAOA,CAAAA,CAAC,CAACL,GAAF,GAAUL,IAAI,CAACK,GAAtB,EAAb,CAAjB,CACA/C,QAAQ,CAACwD,QAAD,CAAR,CACD,CALH,EAMGxC,KANH,CAMS,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CARH,EASD,CACD,QAASyC,CAAAA,oBAAT,OAA8C,IAAdjC,CAAAA,IAAc,OAAdA,IAAc,CAARC,IAAQ,OAARA,IAAQ,CAC5CrD,GAAG,CACAsF,OADH,CACW,CAAElC,IAAI,CAAJA,IAAF,CAAQC,IAAI,CAAJA,IAAR,CADX,EAEGZ,IAFH,CAEQ,SAACmC,OAAD,CAAa,CACjBjD,QAAQ,EAAEiD,OAAF,4BAAclD,KAAd,GAAR,CACA6B,cAAc,GACf,CALH,EAMGZ,KANH,CAMS,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACD,CARH,EASD,CACD;AACA,GAAM2C,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACvD,KAAD,CAAQF,QAAR,CAAqB,CAC9CpB,IAAI,CACD8E,QADH,CACYxD,KADZ,CACmBF,QADnB,CAEE;AAFF,CAGGW,IAHH,CAGQ,SAACC,GAAD,CAAS,CACb,GAAIV,KAAK,EAAIF,QAAb,CAAuB,CACrBQ,eAAe,CAAC,IAAD,CAAf,CACAjB,yBAAyB,CAAC,IAAD,CAAzB,CACAe,OAAO,CAACqD,IAAR,CAAa,SAAb,EACA;AACA,MAAO/C,CAAAA,GAAP,CACD,CAND,IAMO,CACLJ,eAAe,CAAC,KAAD,CAAf,CACD,CACF,CAbH,EAcGK,KAdH,CAcS,SAACC,GAAD,CAAS,CACdvB,yBAAyB,CAAC,IAAD,CAAzB,CACAwB,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACA;AACA,MAAOT,CAAAA,UAAU,CACf,mDADe,CAAjB,CAGD,CArBH,EAsBD,CAvBD,CAwBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA,GAAMuD,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAAC1D,KAAD,CAAQF,QAAR,CAAqB,CACvCpB,IAAI,CACDiF,SADH,CACa3D,KADb,CACoBF,QADpB,EAEGW,IAFH,CAEQ,SAACmD,IAAD,CAAU,CACd,GAAI,CAACA,IAAL,CAAW,CACT,MAAOzD,CAAAA,UAAU,CACf,6CADe,CAAjB,CAGD,CACD,GAAIyD,IAAJ,CAAU,CACR;AACA3D,QAAQ,CAACD,KAAD,CAAR,CACA;AACAH,WAAW,CAAC,IAAD,CAAX,CACA;AACAO,OAAO,CAACqD,IAAR,CAAa,GAAb,EACA,OACD,CACF,CAjBH,EAkBG9C,KAlBH,CAkBS,SAACC,GAAD,CAAS,CACdC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACAT,UAAU,CAACS,GAAG,CAACV,OAAL,CAAV,CACD,CArBH,EAsBD,CAvBD,CAyBA;AACA,QAAS2D,CAAAA,YAAT,EAAwB,CACtBC,YAAY,CAACC,UAAb,CAAwB,KAAxB,EACAlE,WAAW,CAAC,KAAD,CAAX,CACAI,QAAQ,CAAC,EAAD,CAAR,CACAF,WAAW,CAAC,EAAD,CAAX,CACD,CACD,GAAMQ,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CACvB;AACA,GAAIuD,YAAY,CAACE,OAAb,CAAqB,KAArB,CAAJ,CAAiC,CAC/B,GAAMC,CAAAA,GAAG,CAAGH,YAAY,CAACE,OAAb,CAAqB,KAArB,CAAZ,CACA;AACAtF,IAAI,CACDwF,UADH,CACcD,GADd,EAEGxD,IAFH,CAEQ,SAACC,GAAD,CAAS,CACb;AACA,GAAIA,GAAJ,CAAS,CACPT,QAAQ,CAACS,GAAG,CAACkD,IAAJ,CAAS5D,KAAV,CAAR,CACAH,WAAW,CAAC,IAAD,CAAX,CACA;AACAO,OAAO,CAACqD,IAAR,CAAa,GAAb,EACA;AACA;AACA;AACA;AACA;AACD,CACD5C,OAAO,CAACC,GAAR,CAAY,kCAAZ,EACD,CAhBH,EAiBGH,KAjBH,CAiBS,SAACC,GAAD,QAASC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAT,EAjBT,EAkBD,CACF,CAxBD,CA0BA,mBACE,YAAK,SAAS,CAAC,MAAf,uBACE,YAAK,SAAS,CAAC,iBAAf,uBACE,MAAC,kBAAD,CAAoB,QAApB,EAA6B,KAAK,CAAEpB,WAApC,wBACE,KAAC,MACC;AADF,EAEE,KAAK,CAAEQ,KAFT,CAGE,QAAQ,CAAEJ,QAHZ,CAIE,YAAY,CAAEiE,YAJhB,EADF,cAOE,MAAC,MAAD,yBACE,KAAC,cAAD,EACE,SAAS,CAAEnG,IADb,CAEE,KAAK,KAFP,CAGE,IAAI,CAAC,GAHP,CAIE,QAAQ,CAAEkC,QAJZ,CAKE,iBAAiB,CAAEoB,qBALrB,CAME,kBAAkB,CAAEC,sBANtB,CAOE,eAAe,CAAEC,mBAPnB,CAQE,WAAW,CAAEC,eARf,CASE,KAAK,CAAEzB,KATT,CAUE,UAAU,CAAE0C,cAVd,CAWE,YAAY,CAAEa,gBAXhB,CAYE,KAAK,CAAEjD,KAZT,EADF,cAeE,KAAC,KAAD,EAAO,IAAI,CAAC,SAAZ,uBACE,KAAC,QAAD,EAAU,kBAAkB,CAAEuD,kBAA9B,EADF,EAfF,cAkBE,KAAC,KAAD,EAAO,IAAI,CAAC,SAAZ,uBACE,KAAC,KAAD,EACE,WAAW,CAAEG,WADf,CAEE,UAAU,CAAEnD,UAFd,EADF,EAlBF,cAwBE,KAAC,KAAD,EAAO,KAAK,KAAZ,CAAa,IAAI,CAAC,GAAlB,UACGX,QAAQ,cACP,KAAC,QAAD,EAAU,EAAE,CAAC,GAAb,EADO,cAGP,KAAC,QAAD,EAAU,EAAE,CAAC,SAAb,EAJJ,EAxBF,GAPF,CAuCGA,QAAQ,eAAI,KAAC,MAAD,IAvCf,cAyCE,KAAC,gBAAD,EACE,MAAM,CAAEhB,sBADV,CAEE,OAAO,CAAE2C,cAFX,CAGE,YAAY,CAAEO,gBAHhB,EAzCF,cA+CE,KAAC,aAAD,EACE,MAAM,CAAEhD,mBADV,CAEE,OAAO,CAAEyC,cAFX,CAGE,UAAU,CAAE8B,oBAHd,EA/CF,cAqDE,KAAC,eAAD,EACE,MAAM,CAAErE,qBADV,CAEE,OAAO,CAAEuC,cAFX,CAGE,cAAc,CAAEU,kBAHlB,EArDF,cA2DE,KAAC,aAAD,EACE,IAAI,SADN,CAEE,KAAK,gBAFP,CAGE,UAAU,MAHZ,EA3DF,cAiEE,KAAC,UAAD,EACE,IAAI,CAAE3C,YADR,CAEE,OAAO,CAAEiC,cAFX,CAGE,MAAM,CAAErC,gBAHV,EAjEF,cAuEE,KAAC,WAAD,EACE,MAAM,CAAEE,sBADV,CAEE,OAAO,CAAEmC,cAFX,CAGE,aAAa,CAAED,iBAHjB,CAIE,mBAAmB,CAAEjB,YAJvB,EAvEF,GADF,EADF,EADF,CAoFD,CAED,cAAe1B,CAAAA,GAAf","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport Header from \"./Header\";\nimport Footer from \"./Footer\";\nimport Main from \"./Main\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport ImagePopup from \"./ImagePopup\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\nimport api from \"../utils/api\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext.js\";\nimport {\n  Route,\n  Switch,\n  Redirect,\n  useHistory,\n} from \"react-router-dom\";\nimport Login from \"./Login\";\nimport Register from \"./Register\";\nimport ProtectedRoute from \"./ProtectedRoute.js\";\nimport InfoToolTip from \"./InfoTooltip\";\nimport * as auth from \"../utils/auth\";\n\nfunction App() {\n  // State variable and setters\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] =\n    useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] =\n    useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] =\n    useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = useState(false);\n  // NOTE : info tooltip original state\n  const [isInfoToolTipPopupOpen, setIsInfoToolTipPopupOpen] =\n    useState(false);\n  const [selectedCard, setSelectedCard] = useState({});\n  const [currentUser, setCurrentUser] = useState({});\n  const [cards, setCards] = useState([]);\n  //loggedin state\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  // use userData to show user email on the nav\n  // const [userData, setUserData] = useState({});\n  const [password, setPassword] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n\n  const history = useHistory();\n  const [isSuccessful, setIsSuccessful] = React.useState(false);\n\n  //HANDLE AUTHENTICATIONe\n\n  useEffect(() => {\n    tokenCheck();\n  }, []);\n\n  useEffect(() => {\n    api\n      .getInfo()\n      .then((res) => {\n        setCurrentUser(res);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }, []);\n  useEffect(() => {\n    api\n      .getCardList()\n      .then((res) => {\n        setCards(res);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }, []);\n\n  //handlers for opening modals\n  function handleEditAvatarClick() {\n    // console.log(\"The Avatar was clicked.\");\n    setIsEditAvatarPopupOpen(true);\n  }\n  function handleEditProfileClick() {\n    // console.log(\"The Profile was clicked.\");\n    setIsEditProfilePopupOpen(true);\n  }\n  function handleAddPlaceClick() {\n    // console.log(\"The Place button  was clicked.\");\n    setIsAddPlacePopupOpen(true);\n  }\n  //Image Popup\n  function handleCardClick({ name, link }) {\n    setSelectedCard({ name, link });\n    setIsImagePopupOpen(true);\n  }\n  // NOTE :Handle info tooltip\n  function handleInfoTooltip() {\n    setIsInfoToolTipPopupOpen(true);\n  }\n  //close modals\n  function closeAllPopups() {\n    // console.log(\"Popup was closed\");\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsImagePopupOpen(false);\n    // NOTE Close Info Tool Tip\n    setIsInfoToolTipPopupOpen(false);\n    setSelectedCard({});\n  }\n  //ESC Close\n  useEffect(() => {\n    const closeByEscape = (e) => {\n      if (e.key === \"Escape\") {\n        closeAllPopups();\n      }\n    };\n    document.addEventListener(\"keydown\", closeByEscape);\n    return () =>\n      document.removeEventListener(\"keydown\", closeByEscape);\n  }, []);\n\n  //Handle User Update\n  function handleUpdateUser({ name, about }) {\n    api\n      .updateUserInfo({ name, about })\n      .then((res) => {\n        setCurrentUser(res);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n\n  //Handle avatar update\n  function handleUpdateAvatar({ avatar }) {\n    api\n      .setUserAvatar({ avatar })\n      .then((res) => {\n        setCurrentUser(res);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n  function handleCardLike(card) {\n    // Check one more time if this card was already liked\n    const isLiked = card.likes.some((i) => i._id === currentUser._id);\n\n    // Send a request to the API and getting the updated card data\n    if (!isLiked) {\n      api\n        .changeLikeCardStatus(card._id)\n        .then((newCard) => {\n          setCards((state) =>\n            state.map((c) => (c._id === card._id ? newCard : c))\n          );\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    } else {\n      api\n        .deleteLike(card._id)\n        .then((newCard) => {\n          setCards((state) =>\n            state.map((c) => (c._id === card._id ? newCard : c))\n          );\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    }\n  }\n  function handleCardDelete(card) {\n    // After the API request, update the cards state using the filter() method. Create a copy\n    // of the array and exclude the deleted card from it.\n    api\n      .removeCard(card._id)\n      .then(() => {\n        const cardList = cards.filter((c) => c._id !== card._id);\n        setCards(cardList);\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n  function handleAddPlaceSubmit({ name, link }) {\n    api\n      .addCard({ name, link })\n      .then((newCard) => {\n        setCards([newCard, ...cards]);\n        closeAllPopups();\n      })\n      .catch((err) => {\n        console.log(err);\n      });\n  }\n  // REGISTRATION\n  const handleRegistration = (email, password) => {\n    auth\n      .register(email, password)\n      // We only want to redirect users after the registration form has been properly submitted\n      .then((res) => {\n        if (email && password) {\n          setIsSuccessful(true);\n          setIsInfoToolTipPopupOpen(true);\n          history.push(\"/signin\");\n          // console.log(\"res good\");\n          return res;\n        } else {\n          setIsSuccessful(false);\n        }\n      })\n      .catch((err) => {\n        setIsInfoToolTipPopupOpen(true);\n        console.log(err);\n        // console.log(\"res bad\");\n        return setMessage(\n          \"400 - one of the fields was filled in incorrectly\"\n        );\n      });\n  };\n  // const handleRegistration = (email, password) => {\n  //   if (email && password) {\n  //     auth\n  //       .register(email, password)\n  //       // We only want to redirect users after the registration form has been properly submitted\n  //       .then((res) => {\n  //         setIsSuccessful(true);\n  //         setIsInfoToolTipPopupOpen(true);\n  //         history.push(\"/signin\");\n  //         console.log(\"res good\");\n  //         return res;\n  //       })\n  //       .catch((err) => {\n  //         setIsSuccessful(false);\n  //         setIsInfoToolTipPopupOpen(true);\n  //         console.log(err);\n  //       });\n  //   } else {\n  //     // console.log(\"res bad\");\n  //     return setMessage(\n  //       \"400 - one of the fields was filled in incorrectly\"\n  //     );\n  //   }\n  // };\n\n  //LOG IN\n  const handleLogin = (email, password) => {\n    auth\n      .authorize(email, password)\n      .then((data) => {\n        if (!data) {\n          return setMessage(\n            \"one or more of the fields were not provided\"\n          );\n        }\n        if (data) {\n          // set\n          setEmail(email);\n          // TODO  handle login\n          setLoggedIn(true);\n          // redirect user to cards\n          history.push(\"/\");\n          return;\n        }\n      })\n      .catch((err) => {\n        console.log(err);\n        setMessage(err.message);\n      });\n  };\n\n  //LOGOUT\n  function handleLogOut() {\n    localStorage.removeItem(\"jwt\");\n    setLoggedIn(false);\n    setEmail(\"\");\n    setPassword(\"\");\n  }\n  const tokenCheck = () => {\n    // if user has a token in storage, check if it is valid\n    if (localStorage.getItem(\"jwt\")) {\n      const jwt = localStorage.getItem(\"jwt\");\n      // make the request\n      auth\n        .getContent(jwt)\n        .then((res) => {\n          // if response is successful, log in the user\n          if (res) {\n            setEmail(res.data.email);\n            setLoggedIn(true);\n            // also push user to the Home Page\n            history.push(\"/\");\n            // NOTE  : set user data in header. use This method for more than one userData\n            // const userData = {\n            //   email: res.email,\n            // };\n            // setUserData(userData);\n          }\n          console.log(\"something went wrong- tokencheck\");\n        })\n        .catch((err) => console.log(err));\n    }\n  };\n\n  return (\n    <div className=\"page\">\n      <div className=\"page__container\">\n        <CurrentUserContext.Provider value={currentUser}>\n          <Header\n            // userData={userData}\n            email={email}\n            loggedIn={loggedIn}\n            handleLogOut={handleLogOut}\n          />\n          <Switch>\n            <ProtectedRoute\n              component={Main}\n              exact\n              path=\"/\"\n              loggedIn={loggedIn}\n              onEditAvatarClick={handleEditAvatarClick}\n              onEditProfileClick={handleEditProfileClick}\n              onAddPlaceClick={handleAddPlaceClick}\n              onCardClick={handleCardClick}\n              cards={cards}\n              onCardLike={handleCardLike}\n              onCardDelete={handleCardDelete}\n              email={email}\n            />\n            <Route path=\"/signup\">\n              <Register handleRegistration={handleRegistration} />\n            </Route>\n            <Route path=\"/signin\">\n              <Login\n                handleLogin={handleLogin}\n                tokenCheck={tokenCheck}\n              />\n            </Route>\n            <Route exact path=\"/\">\n              {loggedIn ? (\n                <Redirect to=\"/\" />\n              ) : (\n                <Redirect to=\"/signin\" />\n              )}\n            </Route>\n          </Switch>\n          {loggedIn && <Footer />}\n\n          <EditProfilePopup\n            isOpen={isEditProfilePopupOpen}\n            onClose={closeAllPopups}\n            onUpdateUser={handleUpdateUser}\n          />\n\n          <AddPlacePopup\n            isOpen={isAddPlacePopupOpen}\n            onClose={closeAllPopups}\n            onAddPlace={handleAddPlaceSubmit}\n          />\n\n          <EditAvatarPopup\n            isOpen={isEditAvatarPopupOpen}\n            onClose={closeAllPopups}\n            onUpdateAvatar={handleUpdateAvatar}\n          />\n\n          <PopupWithForm\n            name={`delete`}\n            title={`Are you sure?`}\n            buttonText={`Yes`}\n          ></PopupWithForm>\n\n          <ImagePopup\n            card={selectedCard}\n            onClose={closeAllPopups}\n            isOpen={isImagePopupOpen}\n          />\n\n          <InfoToolTip\n            isOpen={isInfoToolTipPopupOpen}\n            onClose={closeAllPopups}\n            onShowToolTip={handleInfoTooltip}\n            isvalidRegistration={isSuccessful}\n          />\n        </CurrentUserContext.Provider>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}